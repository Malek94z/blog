import{a as c,A as h,p as L,d as s}from"./firebase-config-m-BJ8Ik1.js";import{query as M,collection as y,orderBy as w,getDocs as A,deleteDoc as D,doc as g,serverTimestamp as m,updateDoc as k,addDoc as x}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{onAuthStateChanged as T,signOut as p,signInWithPopup as S}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";const E=document.getElementById("login-section"),v=document.getElementById("dashboard-section"),a=document.getElementById("admin-post-list"),b=document.getElementById("post-modal"),I=document.getElementById("post-form"),u=document.getElementById("modal-title");let i=null;T(c,e=>{e&&h.includes(e.email)?(i=e,$()):(e&&(alert("Access denied. You are not an admin."),p(c)),C())});document.getElementById("login-btn").addEventListener("click",async()=>{try{await S(c,L)}catch(e){console.error("Login failed:",e),alert("Login failed: "+e.message)}});document.getElementById("logout-btn").addEventListener("click",()=>{p(c)});function $(){E.style.display="none",v.style.display="block",document.getElementById("user-photo").src=i.photoURL,document.getElementById("user-name").textContent=i.displayName,r()}function C(){E.style.display="flex",v.style.display="none"}async function r(){a.innerHTML='<div class="blog-loading"><div class="spinner"></div><p>Loading posts...</p></div>';try{const e=M(y(s,"blogs"),w("createdAt","desc")),t=await A(e);if(a.innerHTML="",t.empty){a.innerHTML='<p style="text-align: center; color: var(--text-muted);">No posts found. Create your first one!</p>';return}t.forEach(n=>{const o=n.data(),l=n.id,d=document.createElement("div");d.className="admin-post-card",d.innerHTML=`
                <div class="post-info">
                    <h3>${o.title}</h3>
                    <p>${o.category} â€¢ ${o.date}</p>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary edit-btn" data-id="${l}">Edit</button>
                    <button class="btn btn-danger delete-btn" data-id="${l}">Delete</button>
                </div>
            `,a.appendChild(d),d.querySelector(".edit-btn").addEventListener("click",()=>f(l,o)),d.querySelector(".delete-btn").addEventListener("click",()=>N(l))})}catch(e){console.error("Error loading posts:",e),a.innerHTML="<p>Error loading posts.</p>"}}async function N(e){if(confirm("Are you sure you want to delete this post?"))try{await D(g(s,"blogs",e)),r()}catch(t){alert("Delete failed: "+t.message)}}document.getElementById("new-post-btn").addEventListener("click",()=>f());document.getElementById("cancel-btn").addEventListener("click",B);function f(e=null,t=null){if(I.reset(),document.getElementById("post-id").value=e||"",e&&t)u.textContent="Edit Post",document.getElementById("title").value=t.title,document.getElementById("category").value=t.category,document.getElementById("date").value=t.date,document.getElementById("excerpt").value=t.excerpt,document.getElementById("readTime").value=t.readTime||"",document.getElementById("link").value=t.link||"";else{u.textContent="Add New Post";const n=new Date,o=["January","February","March","April","May","June","July","August","September","October","November","December"];document.getElementById("date").value=`${o[n.getMonth()]} ${n.getFullYear()}`}b.style.display="flex"}function B(){b.style.display="none"}I.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("post-id").value,n={title:document.getElementById("title").value,category:document.getElementById("category").value,date:document.getElementById("date").value,excerpt:document.getElementById("excerpt").value,readTime:document.getElementById("readTime").value,link:document.getElementById("link").value,updatedAt:m()};try{t?await k(g(s,"blogs",t),n):(n.createdAt=m(),await x(y(s,"blogs"),n)),B(),r()}catch(o){alert("Save failed: "+o.message)}});
